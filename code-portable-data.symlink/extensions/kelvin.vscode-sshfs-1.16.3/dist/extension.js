module.exports=function(e){var n={},t={3:0};function r(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.e=function(n){if(0!==t[n]){var r=require("./"+n+".extension.js"),o=r.modules,i=r.ids;for(var s in o)e[s]=o[s];for(var c=0;c<i.length;c++)t[i[c]]=0}return Promise.all([])},r.m=e,r.c=n,r.d=function(e,n,t){r.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,n){if(1&n&&(e=r(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(r.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)r.d(t,o,function(n){return e[n]}.bind(null,o));return t},r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,"a",n),n},r.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},r.p="",r.oe=function(e){process.nextTick(function(){throw e})},r(r.s=6)}([function(e,n){e.exports=require("vscode")},function(e,n,t){"use strict";t.d(n,"b",function(){return i}),t.d(n,"d",function(){return s}),t.d(n,"e",function(){return c}),t.d(n,"c",function(){return a}),t.d(n,"a",function(){return u});var r=t(0);const o=r.window.createOutputChannel("ssh-fs");function i(e){o.appendLine(`[DEBUG] ${e}`)}function s(e){o.appendLine(`[INFO] ${e}`)}function c(e){o.appendLine(`[WARNING] ${e}`)}function a(e){e instanceof Error&&e.stack&&(e=`${e.message}\n${e.stack}`),o.appendLine(`[ERROR] ${e}`)}function u(e){return Object.assign({},e,{password:"string"==typeof e.password?"<censored>":e.password,passphrase:"string"==typeof e.passphrase?"<censored>":e.passphrase,privateKey:e.privateKey instanceof Buffer?`Buffer(${e.privateKey.length})`:e.privateKey})}s("Created output channel for vscode-sshfs")},function(e,n,t){"use strict";var r,o=t(5);function i(e,n){void 0===n&&(n=!1);var t=0,r=e.length,o="",i=0,u=16,f=0;function l(n,r){for(var o=0,i=0;o<n||!r;){var s=e.charCodeAt(t);if(s>=48&&s<=57)i=16*i+s-48;else if(s>=65&&s<=70)i=16*i+s-65+10;else{if(!(s>=97&&s<=102))break;i=16*i+s-97+10}t++,o++}return o<n&&(i=-1),i}function d(){if(o="",f=0,i=t,t>=r)return i=r,u=17;var n=e.charCodeAt(t);if(s(n)){do{t++,o+=String.fromCharCode(n),n=e.charCodeAt(t)}while(s(n));return u=15}if(c(n))return t++,o+=String.fromCharCode(n),13===n&&10===e.charCodeAt(t)&&(t++,o+="\n"),u=14;switch(n){case 123:return t++,u=1;case 125:return t++,u=2;case 91:return t++,u=3;case 93:return t++,u=4;case 58:return t++,u=6;case 44:return t++,u=5;case 34:return t++,o=function(){for(var n="",o=t;;){if(t>=r){n+=e.substring(o,t),f=2;break}var i=e.charCodeAt(t);if(34===i){n+=e.substring(o,t),t++;break}if(92!==i){if(i>=0&&i<=31){if(c(i)){n+=e.substring(o,t),f=2;break}f=6}t++}else{if(n+=e.substring(o,t),++t>=r){f=2;break}switch(i=e.charCodeAt(t++)){case 34:n+='"';break;case 92:n+="\\";break;case 47:n+="/";break;case 98:n+="\b";break;case 102:n+="\f";break;case 110:n+="\n";break;case 114:n+="\r";break;case 116:n+="\t";break;case 117:var s=l(4,!0);s>=0?n+=String.fromCharCode(s):f=4;break;default:f=5}o=t}}return n}(),u=10;case 47:var d=t-1;if(47===e.charCodeAt(t+1)){for(t+=2;t<r&&!c(e.charCodeAt(t));)t++;return o=e.substring(d,t),u=12}if(42===e.charCodeAt(t+1)){t+=2;for(var g=r-1,m=!1;t<g;){if(42===e.charCodeAt(t)&&47===e.charCodeAt(t+1)){t+=2,m=!0;break}t++}return m||(t++,f=1),o=e.substring(d,t),u=13}return o+=String.fromCharCode(n),t++,u=16;case 45:if(o+=String.fromCharCode(n),++t===r||!a(e.charCodeAt(t)))return u=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return o+=function(){var n=t;if(48===e.charCodeAt(t))t++;else for(t++;t<e.length&&a(e.charCodeAt(t));)t++;if(t<e.length&&46===e.charCodeAt(t)){if(!(++t<e.length&&a(e.charCodeAt(t))))return f=3,e.substring(n,t);for(t++;t<e.length&&a(e.charCodeAt(t));)t++}var r=t;if(t<e.length&&(69===e.charCodeAt(t)||101===e.charCodeAt(t)))if((++t<e.length&&43===e.charCodeAt(t)||45===e.charCodeAt(t))&&t++,t<e.length&&a(e.charCodeAt(t))){for(t++;t<e.length&&a(e.charCodeAt(t));)t++;r=t}else f=3;return e.substring(n,r)}(),u=11;default:for(;t<r&&h(n);)t++,n=e.charCodeAt(t);if(i!==t){switch(o=e.substring(i,t)){case"true":return u=8;case"false":return u=9;case"null":return u=7}return u=16}return o+=String.fromCharCode(n),t++,u=16}}function h(e){if(s(e)||c(e))return!1;switch(e){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}return{setPosition:function(e){t=e,o="",i=0,u=16,f=0},getPosition:function(){return t},scan:n?function(){var e;do{e=d()}while(e>=12&&e<=15);return e}:d,getToken:function(){return u},getTokenValue:function(){return o},getTokenOffset:function(){return i},getTokenLength:function(){return t-i},getTokenError:function(){return f}}}function s(e){return 32===e||9===e||11===e||12===e||160===e||5760===e||e>=8192&&e<=8203||8239===e||8287===e||12288===e||65279===e}function c(e){return 10===e||13===e||8232===e||8233===e}function a(e){return e>=48&&e<=57}function u(e,n,t){void 0===t&&(t=r.DEFAULT);var o=i(e,!1);function s(e){return e?function(){return e(o.getTokenOffset(),o.getTokenLength())}:function(){return!0}}function c(e){return e?function(n){return e(n,o.getTokenOffset(),o.getTokenLength())}:function(){return!0}}var a=s(n.onObjectBegin),u=c(n.onObjectProperty),f=s(n.onObjectEnd),l=s(n.onArrayBegin),d=s(n.onArrayEnd),h=c(n.onLiteralValue),g=c(n.onSeparator),m=s(n.onComment),p=c(n.onError),w=t&&t.disallowComments,v=t&&t.allowTrailingComma;function y(){for(;;){var e=o.scan();switch(o.getTokenError()){case 4:b(14);break;case 5:b(15);break;case 3:b(13);break;case 1:w||b(11);break;case 2:b(12);break;case 6:b(16)}switch(e){case 12:case 13:w?b(10):m();break;case 16:b(1);break;case 15:case 14:break;default:return e}}}function b(e,n,t){if(void 0===n&&(n=[]),void 0===t&&(t=[]),p(e),n.length+t.length>0)for(var r=o.getToken();17!==r;){if(-1!==n.indexOf(r)){y();break}if(-1!==t.indexOf(r))break;r=y()}}function S(e){var n=o.getTokenValue();return e?h(n):u(n),y(),!0}function k(){switch(o.getToken()){case 3:return function(){l(),y();for(var e=!1;4!==o.getToken()&&17!==o.getToken();){if(5===o.getToken()){if(e||b(4,[],[]),g(","),y(),4===o.getToken()&&v)break}else e&&b(6,[],[]);k()||b(4,[],[4,5]),e=!0}return d(),4!==o.getToken()?b(8,[4],[]):y(),!0}();case 1:return function(){a(),y();for(var e=!1;2!==o.getToken()&&17!==o.getToken();){if(5===o.getToken()){if(e||b(4,[],[]),g(","),y(),2===o.getToken()&&v)break}else e&&b(6,[],[]);(10!==o.getToken()?(b(3,[],[2,5]),0):(S(!1),6===o.getToken()?(g(":"),y(),k()||b(4,[],[2,5])):b(5,[],[2,5]),1))||b(4,[],[2,5]),e=!0}return f(),2!==o.getToken()?b(7,[2],[]):y(),!0}();case 10:return S(!0);default:return function(){switch(o.getToken()){case 11:var e=0;try{"number"!=typeof(e=JSON.parse(o.getTokenValue()))&&(b(2),e=0)}catch(e){b(2)}h(e);break;case 7:h(null);break;case 8:h(!0);break;case 9:h(!1);break;default:return!1}return y(),!0}()}}return y(),17===o.getToken()||(k()?(17!==o.getToken()&&b(9,[],[]),!0):(b(4,[],[]),!1))}!function(e){e.DEFAULT={allowTrailingComma:!1}}(r||(r={}));var f=function(e,n,t){void 0===n&&(n=[]),void 0===t&&(t=r.DEFAULT);var o=null,i=[],s=[];function c(e){Array.isArray(i)?i.push(e):o&&(i[o]=e)}return u(e,{onObjectBegin:function(){var e={};c(e),s.push(i),i=e,o=null},onObjectProperty:function(e){o=e},onObjectEnd:function(){i=s.pop()},onArrayBegin:function(){var e=[];c(e),s.push(i),i=e,o=null},onArrayEnd:function(){i=s.pop()},onLiteralValue:c,onError:function(e,t,r){n.push({error:e,offset:t,length:r})}},t),i[0]};var l=t(0),d=t(4),h=t(1),g=t(3);t.d(n,"d",function(){return w}),t.d(n,"a",function(){return v}),t.d(n,"f",function(){return b}),t.d(n,"e",function(){return S}),t.d(n,"g",function(){return C}),t.d(n,"b",function(){return $}),t.d(n,"c",function(){return F});var m=function(e,n,t,r){return new(t||(t=Promise))(function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){e.done?o(e.value):new t(function(n){n(e.value)}).then(s,c)}a((r=r.apply(e,n||[])).next())})};let p=[];function w(){return p}const v=[];function y(e,n=!1){return m(this,void 0,void 0,function*(){const t=yield Object(g.b)(n=>Object(o.readFile)(e,n)).catch(e=>e);if(t instanceof Error)return"ENOENT"!==t.code||n?(h.c(`Error while reading ${e}: ${t.message}`),[]):[];const r=[],i=f(t.toString(),r);return!i||r.length?(h.c(`Couldn't parse ${e} as a 'JSON with Comments' file`),l.window.showErrorMessage(`Couldn't parse ${e} as a 'JSON with Comments' file`),[]):(i.forEach(n=>n._locations=[n._location=e]),h.b(`Read ${i.length} configs from ${e}`),i)})}function b(){return m(this,void 0,void 0,function*(){h.d("Loading configurations..."),yield function(){return m(this,void 0,void 0,function*(){const e=l.workspace.getConfiguration("sshfs"),n=e.inspect("configs");let t=0;const r=[...n.globalValue||[],...n.workspaceValue||[],...n.workspaceFolderValue||[]];function o(n,o){if(!n)return;let i=!0;return n.forEach(e=>{e.name||([e.name,t]=function(e,n=0){let t=n?`unnamed${n}`:"unnamed";for(;e.find(e=>e.name===t);)t=`unnamed${n+=1}`;return[t,n+1]}(r,t),h.e(`Renamed unnamed config to ${e.name}`),i=!1)}),i?void 0:e.update("configs",n,o).then(()=>{},e=>h.c(`Error while saving configs (CT=${o}): ${e}`))}yield o(n.globalValue,l.ConfigurationTarget.Global),yield o(n.workspaceValue,l.ConfigurationTarget.Workspace),yield o(n.workspaceFolderValue,l.ConfigurationTarget.WorkspaceFolder)})}();const e={folder:[],workspace:[],global:[]},n=l.workspace.getConfiguration("sshfs"),t={workspace:[],global:[]};if(n){const r=n.inspect("configs");e.workspace=r.workspaceValue||[],e.global=r.globalValue||[],e.workspace.forEach(e=>e._locations=[e._location=l.ConfigurationTarget.Workspace]),e.global.forEach(e=>e._locations=[e._location=l.ConfigurationTarget.Global]);const o=n.inspect("configpaths");t.workspace=o.workspaceValue||[],t.global=o.globalValue||[]}for(const n of t.workspace)e.workspace=[...e.workspace,...yield y(n,!0)];for(const n of t.global)e.global=[...e.global,...yield y(n,!0)];const r=[...e.folder,...e.workspace,...e.global];r.forEach(e=>e.name=(e.name||"").toLowerCase());for(const e of r)e.name?Object(d.c)(e.name)&&(h.e(`Found a SSH FS config with the invalid name "${e.name}", prompting user how to handle`),l.window.showErrorMessage(`Invalid SSH FS config name: ${e.name}`,"Rename","Delete","Skip").then(n=>m(this,void 0,void 0,function*(){if("Rename"===n){const n=yield l.window.showInputBox({prompt:`New name for: ${e.name}`,validateInput:d.c,placeHolder:"New name"});if(n){const t=e.name;return h.d(`Renaming config "${t}" to "${n}"`),e.name=n,C(e,t)}}else if("Delete"===n)return $(e);h.e(`Skipped SSH FS config '${e.name}'`),l.window.showWarningMessage(`Skipped SSH FS config '${e.name}'`)}))):(h.c(`Skipped an invalid SSH FS config (missing a name field):\n${JSON.stringify(e,void 0,4)}`),l.window.showErrorMessage("Skipped an invalid SSH FS config (missing a name field)"));return r.filter(e=>!Object(d.c)(e.name))})}function S(){return m(this,void 0,void 0,function*(){const e=yield b(),n=[];for(const t of e){const e=n.find(e=>e.name===t.name);e?e.merge?(h.b(`\tMerging duplicate ${t.name} from ${t._locations}`),e._locations=[...e._locations,...t._locations],Object.assign(e,Object.assign(t,e))):h.b(`\tIgnoring duplicate ${t.name} from ${t._locations}`):(h.b(`\tAdded configuration ${t.name} from ${t._locations}`),n.push(t))}return p=n,h.d(`Found ${p.length} configurations`),v.forEach(e=>e(p)),p})}function k(e,n){return m(this,void 0,void 0,function*(){switch(e){case l.ConfigurationTarget.Global:case l.ConfigurationTarget.Workspace:case l.ConfigurationTarget.WorkspaceFolder:const t=l.workspace.getConfiguration("sshfs"),r=t.inspect("configs"),o=[,r.globalValue,r.workspaceValue,r.workspaceFolderValue][e]||[];let i=n(o);if(!i)return;return i=i.map(e=>{const n=Object.assign({},e);for(const t in e)"_"===t[0]&&delete n[t];return n}),yield t.update("configs",i,e),void h.b(`\tUpdated configs in ${[,"Global","Workspace","WorkspaceFolder"][e]} settings.json`)}if("string"!=typeof e)throw new Error(`Invalid _location field: ${e}`);const t=yield y(e,!0);let r=n(t);if(!r)return;r=r.map(e=>{const n=Object.assign({},e);for(const t in e)"_"===t[0]&&delete n[t];return n});const i=JSON.stringify(r,null,4);yield Object(g.b)(n=>Object(o.writeFile)(e,i,n)).catch(n=>{throw h.c(`Error while writing configs to ${e}: ${n.message}`),n}),h.b(`\tWritten modified configs to ${e}`),yield S()})}function C(e,n=e.name){return m(this,void 0,void 0,function*(){const{name:t,_location:r}=e;if(!t)throw new Error("The given config has no name field");if(!r)throw new Error("The given config has no _location field");h.d(`Saving config ${t} to ${r}`),n!==e.name&&h.b(`\tSaving ${t} will try to overwrite old config ${n}`),yield k(r,t=>{h.b(`\tConfig location '${r}' has following configs: ${t.map(e=>e.name).join(", ")}`);const o=t.findIndex(e=>!!e.name&&e.name.toLowerCase()===n.toLowerCase());return-1===o?(h.b("\tAdding the new config to the existing configs"),t.push(e)):(h.b(`\tOverwriting config '${t[o].name}' at index ${o} with the new config`),t[o]=e),t})})}function $(e){return m(this,void 0,void 0,function*(){const{name:n,_location:t}=e;if(!n)throw new Error("The given config has no name field");if(!t)throw new Error("The given config has no _location field");h.d(`Deleting config ${n} in ${t}`),yield k(t,e=>{h.b(`\tConfig location '${t}' has following configs: ${e.map(e=>e.name).join(", ")}`);const r=e.findIndex(e=>!!e.name&&e.name.toLowerCase()===n.toLowerCase());if(-1===r)throw new Error(`Config '${n}' not found in ${t}`);return h.b(`\tDeleting config '${e[r].name}' at index ${r}`),e.splice(r,1),e})})}function F(e){return"<config>"===e?null:w().find(n=>n.name===e)}l.workspace.onDidChangeConfiguration(e=>m(void 0,void 0,void 0,function*(){return S()})),S()},function(e,n,t){"use strict";t.d(n,"b",function(){return o}),t.d(n,"a",function(){return i});var r=function(e,n,t,r){return new(t||(t=Promise))(function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){e.done?o(e.value):new t(function(n){n(e.value)}).then(s,c)}a((r=r.apply(e,n||[])).next())})};function o(e){return r(this,void 0,void 0,function*(){return new Promise((n,t)=>{try{e((e,r)=>e?t(e):n(r))}catch(e){t(e)}})})}function i(e){return r(this,void 0,void 0,function*(){return new Promise((n,t)=>{try{const r=e(n,t);r instanceof Promise&&r.catch(t)}catch(e){t(e)}})})}},function(e,n,t){"use strict";function r(e){const n=[1,2];for(const{_location:t}of e)t&&(n.find(e=>e===t)||n.push(t));return n}function o(e,n=!1){const t=[];function r(e){t.find(n=>n===e)||t.push(e)}for(const{group:t}of e){if(!t)continue;const e=n?t.split("."):[t];e.forEach((n,t)=>r([...e.slice(0,t),n].join(".")))}return t}function i(e){return e?e.match(/^[\w_\\\/\.@\-+]+$/)?null:"A SSH FS name can only exists of lowercase alphanumeric characters, slashes and any of these: _.+-@":"Missing a name for this SSH FS"}t.d(n,"b",function(){return r}),t.d(n,"a",function(){return o}),t.d(n,"c",function(){return i})},function(e,n){e.exports=require("fs")},function(e,n,t){"use strict";t.r(n);var r=t(0),o=t(2),i=t(1),s=function(e,n,t,r){return new(t||(t=Promise))(function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){e.done?o(e.value):new t(function(n){n(e.value)}).then(s,c)}a((r=r.apply(e,n||[])).next())})};const c=r.workspace.workspaceFolders;class a{constructor(e){this.manager=e,this.onDidChangeFileEmitter=new r.EventEmitter,this.onDidChangeFile=this.onDidChangeFileEmitter.event}assertFs(e){return s(this,void 0,void 0,function*(){const n=this.manager.getFs(e);return n||(function(){const e=r.workspace.workspaceFolders;if(!c!=!e)return!0;if(!c.length!=!e.length)return!0;const[n]=c,[t]=e;if(n===t)return!1;const{name:o,uri:i}=n,{name:s,uri:a}=t;return o!==s||i.toString()!==a.toString()}()?(console.error("Stale workspace"),(yield t.e(2).then(t.bind(null,59))).EMPTY_FILE_SYSTEM):this.manager.createFileSystem(e.authority))})}watch(e,n){return new r.Disposable(()=>{})}stat(e){return s(this,void 0,void 0,function*(){return(yield this.assertFs(e)).stat(e)})}readDirectory(e){return s(this,void 0,void 0,function*(){return(yield this.assertFs(e)).readDirectory(e)})}createDirectory(e){return s(this,void 0,void 0,function*(){return(yield this.assertFs(e)).createDirectory(e)})}readFile(e){return s(this,void 0,void 0,function*(){return i.b(`Reading ${e}`),(yield this.assertFs(e)).readFile(e)})}writeFile(e,n,t){return s(this,void 0,void 0,function*(){return i.b(`Writing ${n.length} bytes to ${e}`),(yield this.assertFs(e)).writeFile(e,n,t)})}delete(e,n){return s(this,void 0,void 0,function*(){return i.b(`Deleting ${e}`),(yield this.assertFs(e)).delete(e,n)})}rename(e,n,t){return s(this,void 0,void 0,function*(){i.b(`Renaming ${e} to ${n}`);const r=yield this.assertFs(e);if(r!==(yield this.assertFs(n)))throw new Error("Can't rename between different SSH filesystems");return r.rename(e,n,t)})}}var u,f=t(4),l=t(3),d=function(e,n,t,r){return new(t||(t=Promise))(function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){e.done?o(e.value):new t(function(n){n(e.value)}).then(s,c)}a((r=r.apply(e,n||[])).next())})};!function(e){e.Idle="Idle",e.Active="Active",e.Deleted="Deleted",e.Connecting="Connecting",e.Error="Error"}(u||(u={}));class h{constructor(e){this.context=e,this.fileSystems=[],this.creatingFileSystems={},this.onDidChangeTreeDataEmitter=new r.EventEmitter,this.onDidChangeTreeData=this.onDidChangeTreeDataEmitter.event,r.workspace.onDidChangeWorkspaceFolders(e=>{const{workspaceFolders:n=[]}=r.workspace;e.removed.forEach(e=>d(this,void 0,void 0,function*(){"ssh"===e.uri.scheme&&(n.find(n=>n.uri.authority===e.uri.authority)||this.commandDisconnect(e.uri.authority))})),this.onDidChangeTreeDataEmitter.fire()}),o.a.push(()=>this.fireConfigChanged())}fireConfigChanged(){this.onDidChangeTreeDataEmitter.fire()}getStatus(e){const n=Object(o.c)(e),t=r.workspace.workspaceFolders||[],i=this.getActive().find(n=>n.name===e),s=t.some(n=>"ssh"===n.uri.scheme&&n.uri.authority===e);return n?s?i?u.Active:this.creatingFileSystems[e]?u.Connecting:u.Error:u.Idle:i?u.Deleted:u.Error}createFileSystem(e,n){return d(this,void 0,void 0,function*(){const s=this.fileSystems.find(n=>n.authority===e);if(s)return s;let c=this.creatingFileSystems[e];return c||(c=Object(l.a)((s,c)=>d(this,void 0,void 0,function*(){const{createSSH:a,getSFTP:u,calculateActualConfig:f}=yield Promise.all([t.e(4),t.e(6)]).then(t.bind(null,61)),{SSHFileSystem:h}=yield t.e(2).then(t.bind(null,59));if(!(n=(n=n||(yield Object(o.e)()).find(n=>n.name===e))&&(yield f(n))||void 0))throw new Error(`A SSH filesystem with the name '${e}' doesn't exist`);const g=yield a(n);if(!g)return c(null);let m=n.root||"/";if(m.startsWith("~")){const n=yield function(e){return d(this,void 0,void 0,function*(){const n=yield Object(l.b)(n=>e.exec("echo Home: ~",n)),{MemoryDuplex:r}=yield t.e(8).then(t.bind(null,60)),o=new r;n.stdout.pipe(o),yield Object(l.b)(e=>n.on("close",e));const i=o.read().toString();if(!i)return null;const s=i.match(/^Home: (.*?)\r?\n?$/);return s?s[1]:null})}(g);if(!n)return yield r.window.showErrorMessage(`Couldn't detect the home directory for '${e}'`,"Okay"),c();m=m.replace(/^~/,n.replace(/\/$/,""))}const p=yield u(g,n),w=new h(e,p,m,n);i.d(`Created SSHFileSystem for ${e}, reading root directory...`);try{const n=r.Uri.parse(`ssh://${e}/`);if(!((yield w.stat(n)).type&r.FileType.Directory))throw r.FileSystemError.FileNotADirectory(n)}catch(n){let t=`Couldn't read the root directory '${w.root}' on the server for SSH FS '${e}'`;return n instanceof r.FileSystemError&&(t=`Path '${w.root}' in SSH FS '${e}' is not a directory`),i.c(n),yield r.window.showErrorMessage(t,"Okay"),c()}return this.fileSystems.push(w),delete this.creatingFileSystems[e],r.commands.executeCommand("workbench.files.action.refreshFilesExplorer"),this.onDidChangeTreeDataEmitter.fire(),g.once("close",n=>n?this.commandReconnect(e):!w.closing&&this.promptReconnect(e)),s(w)})).catch(n=>{if(this.onDidChangeTreeDataEmitter.fire(),!n)throw delete this.creatingFileSystems[e],this.commandDisconnect(e),n;throw i.c(`Error while connecting to SSH FS ${e}:\n${n.message}`),i.c(n),r.window.showErrorMessage(`Error while connecting to SSH FS ${e}:\n${n.message}`,"Retry","Configure","Ignore").then(n=>{delete this.creatingFileSystems[e],"Retry"===n?this.createFileSystem(e).catch(()=>{}):"Configure"===n?this.commandConfigure(e):this.commandDisconnect(e)}),n}),this.creatingFileSystems[e]=c)})}getActive(){return this.fileSystems.map(e=>e.config)}getFs(e){const n=this.fileSystems.find(n=>n.authority===e.authority);return n||null}promptReconnect(e){return d(this,void 0,void 0,function*(){const n=Object(o.c)(e);console.log("config",e,n),n&&("Reconnect"===(yield r.window.showWarningMessage(`SSH FS ${n.label||n.name} disconnected`,"Reconnect","Disconnect"))?this.commandReconnect(e):this.commandDisconnect(e))})}getTreeItem(e){return function(e,n){if("string"==typeof n)return{label:n.replace(/^.+\./,""),collapsibleState:r.TreeItemCollapsibleState.Collapsed};const t=(r.workspace.workspaceFolders||[]).some(e=>"ssh"===e.uri.scheme&&e.uri.authority===n.name),o=e.getStatus(n.name);return{label:n&&n.label||n.name,contextValue:t?"active":"inactive",tooltip:"Deleted"===o?"Active but deleted":o,iconPath:e.context.asAbsolutePath(`resources/config/${o}.png`)}}(this,e)}getChildren(e=""){if("object"==typeof e)return[];const n=this.fileSystems.map(e=>e.config);n.push(...Object(o.d)().filter(e=>!n.find(n=>e.name===n.name)));const t=n.filter(({group:n})=>(n||"")===e);t.sort((e,n)=>e.name>n.name?1:-1);let r=Object(f.a)(n,!0);return r=e?r.filter(n=>n.startsWith(e)&&"."===n[e.length]&&!n.includes(".",e.length+1)):r.filter(e=>!e.includes(".")),[...t,...r.sort()]}commandDisconnect(e){"object"==typeof e&&(e=e.name),i.d(`Command received to disconnect ${e}`);const n=this.fileSystems.find(n=>n.authority===e);n&&(n.disconnect(),this.fileSystems.splice(this.fileSystems.indexOf(n),1)),delete this.creatingFileSystems[e];const t=r.workspace.workspaceFolders.findIndex(n=>"ssh"===n.uri.scheme&&n.uri.authority===e);-1!==t&&r.workspace.updateWorkspaceFolders(t,1),this.onDidChangeTreeDataEmitter.fire()}commandReconnect(e){"object"==typeof e&&(e=e.name),i.d(`Command received to reconnect ${e}`);const n=this.fileSystems.find(n=>n.authority===e);n&&(n.disconnect(),this.fileSystems.splice(this.fileSystems.indexOf(n),1)),delete this.creatingFileSystems[e],this.commandConnect(e)}commandConnect(e){const n="object"==typeof e?e:void 0;if("object"==typeof e&&(e=e.name),i.d(`Command received to connect ${e}`),this.getActive().find(n=>n.name===e))return r.commands.executeCommand("workbench.files.action.refreshFilesExplorer");const t=r.workspace.workspaceFolders;if(t&&t.find(n=>"ssh"===n.uri.scheme&&n.uri.authority===e))return this.onDidChangeTreeDataEmitter.fire(),this.createFileSystem(e,n);r.workspace.updateWorkspaceFolders(t?t.length:0,0,{uri:r.Uri.parse(`ssh://${e}/`),name:`SSH FS - ${e}`}),this.onDidChangeTreeDataEmitter.fire()}commandConfigure(e){return d(this,void 0,void 0,function*(){if(i.d(`Command received to configure ${"string"==typeof e?e:e.name}`),"object"==typeof e)return void this.openSettings({config:e,type:"editconfig"});e=e.toLowerCase();let n=yield Object(o.f)();if(0===(n=n.filter(n=>n.name===e)).length)throw new Error("Unexpectedly found no matching configs?");const t=1===n.length?n[0]:n;this.openSettings({config:t,type:"editconfig"})})}openSettings(e){return d(this,void 0,void 0,function*(){const{open:n,navigate:r}=yield t.e(7).then(t.bind(null,62));return e?r(e):n()})}}t.d(n,"activate",function(){return p});var g=function(e,n,t,r){return new(t||(t=Promise))(function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){e.done?o(e.value):new t(function(n){n(e.value)}).then(s,c)}a((r=r.apply(e,n||[])).next())})};function m(e){const{username:n,host:t,putty:r}=e,o=e.port&&22!==e.port?`:${e.port}`:"";return r?"string"==typeof r?`PuTTY session "${r}"`:"PuTTY session (deduced from config)":t?n?`${n}@${t}${o}`:`${t}${o}`:void 0}function p(e){i.d(`Extension activated, version ${function(){const e=r.extensions.getExtension("Kelvin.vscode-sshfs");return e&&e.packageJSON&&e.packageJSON.version}()}`);const n=new h(e),t=e.subscriptions.push.bind(e.subscriptions),s=(e,n,o)=>t(r.commands.registerCommand(e,n,o));function c(e,t,i){return g(this,void 0,void 0,function*(){(t=t||(yield function(e,n){return g(this,void 0,void 0,function*(){let t=e.getActive();const i=yield Object(o.e)();!1===n?t=i.filter(e=>!t.find(n=>n.name===e.name)):void 0===n&&i.forEach(e=>!t.find(n=>n.name===e.name)&&t.push(e));const s=t.map(e=>({name:e.name,description:e.name,label:e.label||e.name,detail:m(e)})),c=yield r.window.showQuickPick(s,{placeHolder:"SSH FS Configuration"});return c&&c.name})}(n,i)))&&e.call(n,t)})}t(r.workspace.registerFileSystemProvider("ssh",new a(n),{isCaseSensitive:!0})),t(r.window.createTreeView("sshfs-configs",{treeDataProvider:n,showCollapseAll:!0})),s("sshfs.new",()=>g(this,void 0,void 0,function*(){return n.openSettings({type:"newconfig"})})),s("sshfs.settings",()=>n.openSettings()),s("sshfs.connect",e=>c(n.commandConnect,e,!1)),s("sshfs.disconnect",e=>c(n.commandDisconnect,e,!0)),s("sshfs.reconnect",e=>c(n.commandReconnect,e,!0)),s("sshfs.configure",e=>c(n.commandConfigure,e)),s("sshfs.reload",o.e)}},function(e,n){e.exports=require("util")},function(e,n){e.exports=require("stream")},function(e,n){e.exports=require("events")},function(e,n){e.exports=require("net")},function(e,n){e.exports=require("path")},function(e,n){e.exports=require("crypto")},function(e,n){e.exports=require("dns")},function(e,n){e.exports=require("assert")},function(e,n){e.exports=require("buffer")},function(e,n){e.exports=require("child_process")},function(e,n){e.exports=require("zlib")},function(e,n){e.exports=require("http")},function(e,n){e.exports=require("os")},function(e,n){e.exports=require("request")}]);
//# sourceMappingURL=extension.js.map